<div class="navbar-inner">
  <div class="container">
    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </a>
    <%= link_to Contour.application_name.html_safe, root_path, class: 'brand' %>
    <div class="nav-collapse">

<% display = ['not_signed_in', 'always'] %>
<% if user_signed_in? -%>
  <% display = ['signed_in', 'always'] %>
<% end %>


    <% Contour.menu_items.group_by{|i| i[:position]}.each do |position, items| %>
      <ul class="nav <%= 'pull-right' if position == 'right' %>">
        <% items.each_with_index do |menu_item, index| %>
          <% if display.include?(menu_item[:display]) and (menu_item[:condition].blank? or eval(menu_item[:condition])) %>
            <li class="<%= 'dropdown' if (menu_item[:links] || []).size > 0 %>" id="menu<%= position %><%= index %>">
              <%= link_to(
                  (menu_item[:eval] ? eval(menu_item[:name]) : menu_item[:name].html_safe + (menu_item[:image].blank? ? '' : image_tag(menu_item[:image], menu_item[:image_options]))),
                  (menu_item[:path].blank? ? '#' : eval(menu_item[:path].to_s)),
                  target: menu_item[:target], style: "#{ 'display:inline-block;padding-right:0px' if (menu_item[:links] || []).size > 0 }")
                   %>
              <%= link_to "<b class='caret'></b>".html_safe, '#', 'data-target' => "#menu#{position}#{index}", class: 'dropdown-toggle', 'data-toggle' => 'dropdown', style: 'display:inline-block;padding-left:0px' if (menu_item[:links] || []).size > 0 %>
              <% if menu_item[:links].size > 0 %>
                <ul class="dropdown-menu">
                <% menu_item[:links].each do |link| %>
                  <% if link[:condition].blank? or eval(link[:condition]) %>
                    <% if link[:divider] != true %>
                      <li><%= link_to (link[:eval] ? eval(link[:html].blank? ? link[:name] : link[:html].html_safe) : (link[:html].blank? ? link[:name] : link[:html].html_safe) + (link[:image].blank? ? '' : image_tag(link[:image], link[:image_options]))).html_safe, link[:path].blank? ? '#' : eval(link[:path].to_s), target: link[:target] %></li>
                    <% else %>
                      <li class="divider"></li>
                    <% end %>
                  <% end %>
                <% end %>
                </ul>
              <% end %>
            </li>
          <% end %>
        <% end %>
      </ul>
    <% end %>



<% if false %>
      <ul class="nav">
        <li class="dropdown" id="menu1">
          <%= link_to "Calendar".html_safe, '#', 'data-target2' => "#menu1", class: 'dropdown-toggle' %>
          <ul class="dropdown-menu">
            <li><%= link_to 'Calendar', '#' %></li>
            <li><%= link_to 'Sub Item', '#' %></li>
          </ul>
        </li>
        <li><%= link_to "Stickies", '#' %></li>
        <li><%= link_to "Projects", '#' %></li>
        <li><%= link_to "About", '#' %></li>
      </ul>
      <% if signed_in? %>
        <ul class="nav pull-right">
          <li class="dropdown" id="menu2">
            <%= link_to "current_user.name <b class='caret'></b>".html_safe, calendar_stickies_path, 'data-target' => "#menu2", class: 'dropdown-toggle' %>
            <ul class="dropdown-menu">
              <li><%= link_to 'Settings', '#' %></li>
              <li><%= link_to 'Authentications', '#' %></li>
              <li class="divider"></li>
              <li><%= link_to 'Logout', destroy_user_session_path %></li>
            </ul>
          </li>
        </ul>
      <% else %>
        <ul class="nav pull-right">
          <li class="dropdown" id="menu2">
            <%= link_to 'Login', new_user_session_path %>
          </li>
        </ul>
      <% end %>
<% end %>
    </div>
  </div>
</div>




<% if false %>

<% display = ['not_signed_in', 'always'] %>
<% if user_signed_in? -%>
  <% display = ['signed_in', 'always'] %>
<% end %>

<ul class="ul-menu">
  <% Contour.menu_items.each do |menu_item| %>
    <% if display.include?(menu_item[:display]) and (menu_item[:condition].blank? or eval(menu_item[:condition])) %>
      <li class="parent li_<%= menu_item[:position] %>">
        <%= link_to_if (not menu_item[:path].blank?), (menu_item[:eval] ? eval(menu_item[:name]) : menu_item[:name].html_safe + (menu_item[:image].blank? ? '' : image_tag(menu_item[:image], menu_item[:image_options]))), eval(menu_item[:path].to_s), class: 'noicon', target: menu_item[:target] %>
        <% if menu_item[:links].size > 0 %>
          <ul>
          <% menu_item[:links].each do |link| %>
            <% if link[:condition].blank? or eval(link[:condition]) %>
              <% if link[:html].blank? %>
                <li><%= link_to_if (not link[:path].blank?), (link[:eval] ? eval(link[:name]) : link[:name].html_safe + (link[:image].blank? ? '' : image_tag(link[:image], link[:image_options]))), eval(link[:path].to_s), class: 'noicon', target: link[:target] %></li>
              <% else %>
                <li><%= (link[:eval] ? eval(link[:html]) : link[:html]).html_safe %></li>
              <% end %>
            <% end %>
          <% end %>
          </ul>
        <% end %>
      </li>
    <% end %>
  <% end %>
  <%= render partial: 'contour/authentications/menu' unless user_signed_in? %>
</ul>
<% end %>
